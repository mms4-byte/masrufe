<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø§Ù„ÙŠØ© Ø§Ù„Ù…Ù„ÙƒÙŠ - Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø³Ø­Ø§Ø¨ÙŠØ©</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root {
            --bg: #0a0c10; --card: #161b22; --border: #30363d;
            --accent: #58a6ff; --text: #c9d1d9; --gold: #d29922;
        }

        body { background-color: var(--bg); color: var(--text); font-family: 'Segoe UI', sans-serif; margin: 0; padding: 0; }

        /* Ø´Ø§Ø´Ø© Ø§Ù„Ù‚ÙÙ„ Ø§Ù„Ù…Ø­ØµÙ†Ø© */
        #lock-screen {
            position: fixed; inset: 0; background: #000; z-index: 9999;
            display: flex; justify-content: center; align-items: center;
        }
        #lock-screen input {
            background: #000; border: 1px solid #444; color: #fff;
            padding: 15px; border-radius: 10px; text-align: center; font-size: 1.2rem; width: 200px;
        }

        #main-app { display: none; max-width: 900px; margin: auto; padding: 10px; }

        .header-sticky {
            position: sticky; top: 0; z-index: 100; background: var(--bg);
            padding: 10px 0; border-bottom: 2px solid var(--border);
        }

        .stats-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
        .stat-card { background: var(--card); padding: 12px; border-radius: 10px; border: 1px solid var(--border); text-align: center; }

        .input-box {
            background: var(--card); padding: 15px; border-radius: 12px; border: 1px solid var(--border);
            margin: 15px 0; display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px;
        }
        input { background: #0d1117; border: 1px solid var(--border); color: white; padding: 10px; border-radius: 6px; outline: none; }
        
        .btn { padding: 10px; border-radius: 8px; border: none; font-weight: bold; cursor: pointer; }
        .btn-add { background: var(--accent); color: #000; grid-column: span 3; margin-top: 5px; }
        .btn-log { background: var(--gold); color: #000; width: 100%; margin-top: 10px; }

        /* Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø­Ø¯Ø« Ø¨Ø¹Ù…ÙˆØ¯ Ø§Ù„ØªØ§Ø±ÙŠØ® */
        .table-wrapper { background: var(--card); border-radius: 12px; border: 1px solid var(--border); overflow: auto; max-height: 400px; }
        table { width: 100%; border-collapse: collapse; min-width: 600px; }
        th { background: #21262d; padding: 12px; position: sticky; top: 0; z-index: 5; text-align: center; }
        td { padding: 12px; text-align: center; border-bottom: 1px solid var(--border); }

        /* Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù„Ø®Øµ */
        #log-modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 1000; padding: 20px; }
        .log-inner { background: var(--card); max-width: 450px; margin: auto; padding: 20px; border-radius: 15px; border: 1px solid var(--border); }

        /* Ø§Ù„ÙˆØµÙ„ Ø§Ù„Ø£ØµÙØ± Ø§Ù„Ø±Ø³Ù…ÙŠ */
        #summary-receipt {
            position: absolute; left: -9999px;
            width: 320px; background: #fffbe6; color: #000;
            padding: 40px 25px; font-family: 'Arial', sans-serif;
            border: 2px solid #000;
        }
        .rec-header { text-align: center; border-bottom: 2px solid #000; padding-bottom: 10px; margin-bottom: 15px; }
        .rec-row { display: flex; justify-content: space-between; margin: 10px 0; font-weight: bold; font-size: 16px; border-bottom: 1px dashed #666; padding-bottom: 5px; }
        .rec-total { background: #000; color: #fff; padding: 12px; text-align: center; margin-top: 20px; font-size: 1.2rem; font-weight: bold; }
        .rec-signature { margin-top: 40px; border-top: 2px solid #000; width: 140px; text-align: center; padding-top: 5px; font-weight: bold; }
    </style>
</head>
<body>

    <div id="lock-screen">
        <input type="password" id="passInput" placeholder="Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø³Ø±ÙŠ" oninput="unlock(this.value)">
    </div>

    <div id="main-app">
        <div class="header-sticky">
            <div class="stats-grid">
                <div class="stat-card">Ø§Ù„Ø±Ø§ØªØ¨<br><b>720,000</b></div>
                <div class="stat-card">Ø§Ù„Ù…ØµØ±ÙˆÙ<br><b id="totalSpent" style="color:#ff7b72">0</b></div>
                <div class="stat-card">Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ<br><b id="totalBalance" style="color:#7ee787">720,000</b></div>
            </div>
            <button class="btn btn-log" onclick="openLog()">ğŸ“‘ Ø¹Ø±Ø¶ Ù…Ù„Ø®Øµ Ø§Ù„ÙØ¦Ø§Øª ÙˆØ§Ù„Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØµÙØ±Ø§Ø¡</button>
        </div>

        <div class="input-box">
            <input type="text" id="inName" placeholder="Ø§Ù„Ù…Ø§Ø¯Ø© (Ù…ØŒ Ø®ØŒ Ø¯..)">
            <input type="number" id="inPrice" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº (20=20Ø£Ù„Ù)">
            <input type="text" id="inNote" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø©">
            <button class="btn btn-add" onclick="addItem()">Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ø¬Ù„</button>
        </div>

        <div class="table-wrapper">
            <table>
                <thead>
                    <tr>
                        <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                        <th>Ø§Ù„Ù…Ø§Ø¯Ø©</th>
                        <th>Ø§Ù„Ù…Ø¨Ù„Øº</th>
                        <th>Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©</th>
                        <th>Ø­Ø°Ù</th>
                    </tr>
                </thead>
                <tbody id="mainTable"></tbody>
            </table>
        </div>
    </div>

    <div id="log-modal">
        <div class="log-inner">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <h3>Ù…Ù„Ø®Øµ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª</h3>
                <button onclick="closeLog()" style="background:none; border:none; color:white; font-size:1.5rem; cursor:pointer">Ã—</button>
            </div>
            <div id="logBody" style="margin-top:15px;"></div>
            <button class="btn" style="background:#2ecc71; color:#000; width:100%; margin-top:20px;" onclick="printSummary()">
                <i class="fas fa-print"></i> ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙˆØµÙ„ Ø§Ù„Ø£ØµÙØ± Ø§Ù„Ø±Ø³Ù…ÙŠ
            </button>
        </div>
    </div>

    <div id="summary-receipt">
        <div class="rec-header">
            <h2 style="margin:0;">Ù…Ù„Ø®Øµ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª</h2>
            <p id="rec-date-top" style="font-size:13px; margin-top:5px; font-weight:bold;"></p>
        </div>
        <div id="receipt-items-list"></div>
        <div class="rec-total">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙƒÙ„ÙŠ: <span id="rec-grand-total"></span> Ø¯.Ø¹</div>
        <div class="rec-signature">Ø§Ù„Ù…Ø­Ø§Ø³Ø¨: ________</div>
    </div>

<script>
    const SALARY = 720000;
    const USER_ID = "ROYAL_KING_2026"; // Ø§ÙŠØ¯ Ø«Ø§Ø¨Øª Ø®Ø§Øµ Ø¨Ùƒ Ù„Ù„Ø°Ø§ÙƒØ±Ø©
    let db = JSON.parse(localStorage.getItem(USER_ID)) || [];
    const shortcuts = {'Ù…': 'Ù…ÙˆÙ„Ø¯', 'Ø®': 'Ù…Ø®Ø¶Ø±', 'Ø¯': 'Ø¯Ø¬Ø§Ø¬/Ù„Ø­ÙˆÙ…', 'Ù†': 'Ø§Ù†ØªØ±Ù†Øª', 'Øµ': 'Ù…ØµØ±ÙˆÙ Ø´Ø®ØµÙŠ', 'Ø±': 'Ø±ØµÙŠØ¯'};

    function unlock(v) {
        if(v === "2006") {
            document.getElementById('lock-screen').style.display = 'none';
            document.getElementById('main-app').style.display = 'block';
            updateUI();
        }
    }

    function addItem() {
        let name = document.getElementById('inName').value;
        let price = parseFloat(document.getElementById('inPrice').value);
        let note = document.getElementById('inNote').value || "-";
        if(!name || isNaN(price)) return;
        if(shortcuts[name]) name = shortcuts[name];

        const now = new Date();
        const dateStr = now.toLocaleDateString('ar-EG');
        
        db.push({ id: Date.now(), name, price: price * 1000, note, date: dateStr });
        localStorage.setItem(USER_ID, JSON.stringify(db)); // Ø§Ù„Ø­ÙØ¸ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø§ÙŠØ¯ Ø§Ù„Ø«Ø§Ø¨Øª
        updateUI();
        document.getElementById('inName').value = ''; document.getElementById('inPrice').value = '';
    }

    function updateUI() {
        let spent = 0;
        const body = document.getElementById('mainTable');
        body.innerHTML = '';
        db.forEach(i => spent += i.price);
        document.getElementById('totalSpent').innerText = spent.toLocaleString();
        document.getElementById('totalBalance').innerText = (SALARY - spent).toLocaleString();

        db.slice().reverse().forEach(item => {
            const row = body.insertRow();
            row.innerHTML = `
                <td style="font-size:0.8rem">${item.date}</td>
                <td><b>${item.name}</b></td>
                <td style="font-weight:bold">${item.price.toLocaleString()}</td>
                <td style="font-size:0.85rem; color:#8b949e">${item.note}</td>
                <td><i class="fas fa-trash" style="color:#ff7b72; cursor:pointer" onclick="deleteItem(${item.id})"></i></td>`;
        });
    }

    function deleteItem(id) {
        if(confirm("Ø­Ø°ÙØŸ")) { 
            db = db.filter(i => i.id !== id); 
            localStorage.setItem(USER_ID, JSON.stringify(db)); 
            updateUI(); 
        }
    }

    function openLog() {
        document.getElementById('log-modal').style.display = 'block';
        const cats = {};
        db.forEach(i => cats[i.name] = (cats[i.name] || 0) + i.price);
        let html = '';
        for(let c in cats) html += `<div style="display:flex; justify-content:space-between; padding:8px; border-bottom:1px solid #333;"><span>${c}</span><b>${cats[c].toLocaleString()}</b></div>`;
        document.getElementById('logBody').innerHTML = html || "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª";
    }

    async function printSummary() {
        const cats = {};
        let total = 0;
        db.forEach(i => { cats[i.name] = (cats[i.name] || 0) + i.price; total += i.price; });

        const now = new Date();
        document.getElementById('rec-date-top').innerText = now.toLocaleDateString('ar-EG') + " | " + now.toLocaleTimeString('ar-EG');

        let itemsHtml = '';
        for(let c in cats) itemsHtml += `<div class="rec-row"><span>${c}</span><span>${cats[c].toLocaleString()}</span></div>`;
        
        document.getElementById('receipt-items-list').innerHTML = itemsHtml;
        document.getElementById('rec-grand-total').innerText = total.toLocaleString();

        const receipt = document.getElementById('summary-receipt');
        html2canvas(receipt, { backgroundColor: "#fffbe6", scale: 3 }).then(canvas => {
            const link = document.createElement('a');
            link.download = `ÙˆØµÙ„_Ù…Ù„Ø®Øµ_${now.getTime()}.png`;
            link.href = canvas.toDataURL();
            link.click();
        });
    }

    function closeLog() { document.getElementById('log-modal').style.display = 'none'; }
</script>
</body>
</html>
