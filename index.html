<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ù„ÙƒÙŠ - Ù‚ÙÙ„ Ù…Ø·ÙˆØ±</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root {
            --bg: #0a0c10; --card: #161b22; --border: #30363d;
            --accent: #58a6ff; --text: #c9d1d9; --gold: #d29922;
        }

        body { background-color: var(--bg); color: var(--text); font-family: 'Segoe UI', sans-serif; margin: 0; padding: 0; }

        /* Ø´Ø§Ø´Ø© Ø§Ù„Ù‚ÙÙ„ Ø§Ù„Ù…Ø­Ø³Ù†Ø© - Ø£Ù„ÙˆØ§Ù† ÙˆØ§Ø¶Ø­Ø© */
        #lock-screen {
            position: fixed; inset: 0; background: #0d1117; z-index: 99999;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
        }
        .lock-title { color: var(--accent); margin-bottom: 20px; font-weight: bold; letter-spacing: 2px; }
        
        #passInput {
            background: #1c2128;
            border: 2px solid var(--border);
            color: #fff;
            padding: 15px;
            border-radius: 12px;
            text-align: center;
            font-size: 2rem;
            width: 180px;
            outline: none;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.5);
        }
        /* ØªÙˆÙ‡Ø¬ ÙˆØ§Ø¶Ø­ Ø¹Ù†Ø¯ Ø§Ù„ÙƒØªØ§Ø¨Ø© */
        #passInput:focus {
            border-color: var(--accent);
            box-shadow: 0 0 25px rgba(88, 166, 255, 0.5);
            background: #22272e;
        }

        #main-app { display: none; max-width: 900px; margin: auto; padding: 10px; }

        .header-sticky { position: sticky; top: 0; z-index: 100; background: var(--bg); padding: 10px 0; border-bottom: 2px solid var(--border); }
        .stats-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
        .stat-card { background: var(--card); padding: 12px; border-radius: 10px; border: 1px solid var(--border); text-align: center; }

        .input-box { background: var(--card); padding: 15px; border-radius: 12px; border: 1px solid var(--border); margin: 15px 0; display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; }
        .input-box input { background: #0d1117; border: 1px solid var(--border); color: white; padding: 10px; border-radius: 6px; outline: none; }
        .btn-add { background: var(--accent); color: #000; font-weight: bold; grid-column: span 3; margin-top: 5px; cursor: pointer; border: none; padding: 12px; border-radius: 8px; }

        .table-wrapper { background: var(--card); border-radius: 12px; border: 1px solid var(--border); overflow: auto; max-height: 450px; }
        table { width: 100%; border-collapse: collapse; min-width: 600px; }
        th { background: #21262d; padding: 12px; position: sticky; top: 0; z-index: 10; border-bottom: 2px solid var(--border); }
        td { padding: 12px; text-align: center; border-bottom: 1px solid var(--border); }

        /* Ø§Ù„ÙˆØµÙ„ Ø§Ù„Ø£ØµÙØ± Ø§Ù„Ø±Ø³Ù…ÙŠ */
        #summary-receipt { position: absolute; left: -9999px; width: 320px; background: #fffbe6; color: #000; padding: 40px 25px; border: 2px solid #000; font-family: Arial, sans-serif; }
        .rec-row { display: flex; justify-content: space-between; margin: 10px 0; font-weight: bold; border-bottom: 1px dashed #000; padding-bottom: 5px; }
        .rec-total { background: #000; color: #fff; padding: 12px; text-align: center; margin-top: 20px; font-weight: bold; font-size: 1.2rem; }

        #log-modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 1000; padding: 20px; }
        .log-inner { background: var(--card); max-width: 450px; margin: auto; padding: 20px; border-radius: 15px; border: 1px solid var(--border); }
    </style>
</head>
<body>

    <div id="lock-screen">
        <div class="lock-title">Ù†Ø¸Ø§Ù… Ø§Ù„Ø®Ø²Ù†Ø© Ø§Ù„Ù…Ù„ÙƒÙŠØ©</div>
        <input type="password" id="passInput" maxlength="4" placeholder="Ø§Ù„Ø±Ù…Ø²" oninput="unlock(this.value)">
        <p style="color: #444; margin-top: 20px; font-size: 0.9rem;">Ø£Ø¯Ø®Ù„ Ø±Ù…Ø² Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø©</p>
    </div>

    <div id="main-app">
        <div class="header-sticky">
            <div class="stats-grid">
                <div class="stat-card">Ø§Ù„Ø±Ø§ØªØ¨<br><b>720,000</b></div>
                <div class="stat-card">Ø§Ù„Ù…ØµØ±ÙˆÙ<br><b id="totalSpent" style="color:#ff7b72">0</b></div>
                <div class="stat-card">Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ<br><b id="totalBalance" style="color:#7ee787">720,000</b></div>
            </div>
            <button onclick="openLog()" style="background:var(--gold); color:#000; width:100%; margin-top:10px; font-weight:bold; padding:12px; border-radius:8px; border:none; cursor:pointer;">ğŸ“‘ ÙƒØ´Ù Ø§Ù„Ø­Ø³Ø§Ø¨ ÙˆØ§Ù„Ø·Ø¨Ø§Ø¹Ø©</button>
        </div>

        <div class="input-box">
            <input type="text" id="inName" placeholder="Ø§Ù„Ù…Ø§Ø¯Ø© (Ù…ØŒ Ø®...)">
            <input type="number" id="inPrice" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº (20=20Ø£Ù„Ù)">
            <input type="text" id="inNote" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø©">
            <button class="btn-add" onclick="addItem()">Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ø¬Ù„</button>
        </div>

        <div class="table-wrapper">
            <table>
                <thead>
                    <tr>
                        <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                        <th>Ø§Ù„Ù…Ø§Ø¯Ø©</th>
                        <th>Ø§Ù„Ù…Ø¨Ù„Øº</th>
                        <th>Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©</th>
                        <th>Ø­Ø°Ù</th>
                    </tr>
                </thead>
                <tbody id="mainTable"></tbody>
            </table>
        </div>
    </div>

    <div id="log-modal">
        <div class="log-inner">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <h3>Ù…Ù„Ø®Øµ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª</h3>
                <button onclick="closeLog()" style="background:none; border:none; color:white; font-size:1.5rem; cursor:pointer">Ã—</button>
            </div>
            <div id="logBody" style="margin-top:15px;"></div>
            <button onclick="printSummary()" style="background:#2ecc71; color:#000; width:100%; margin-top:20px; padding:12px; font-weight:bold; border:none; border-radius:8px; cursor:pointer;">
                <i class="fas fa-print"></i> ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙˆØµÙ„ Ø§Ù„Ø£ØµÙØ±
            </button>
        </div>
    </div>

    <div id="summary-receipt">
        <div style="text-align:center; border-bottom: 2px solid #000; padding-bottom:10px; margin-bottom:15px;">
            <h2 style="margin:0;">Ù…Ù„Ø®Øµ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª Ø§Ù„Ø´Ù‡Ø±ÙŠ</h2>
            <p id="rec-date-top" style="font-size:13px; font-weight:bold; margin-top:5px;"></p>
        </div>
        <div id="receipt-items-list"></div>
        <div class="rec-total">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙƒÙ„ÙŠ: <span id="rec-grand-total"></span> Ø¯.Ø¹</div>
        <div style="margin-top:40px; border-top:2px solid #000; width:140px; text-align:center; font-weight:bold; padding-top:5px;">Ø§Ù„Ù…Ø­Ø§Ø³Ø¨: ________</div>
    </div>

<script>
    const SALARY = 720000;
    const USER_ID = "ROYAL_V10_SECURE"; 
    let db = JSON.parse(localStorage.getItem(USER_ID)) || [];
    const shortcuts = {'Ù…': 'Ù…ÙˆÙ„Ø¯', 'Ø®': 'Ù…Ø®Ø¶Ø±', 'Ø¯': 'Ø¯Ø¬Ø§Ø¬/Ù„Ø­ÙˆÙ…', 'Ù†': 'Ø§Ù†ØªØ±Ù†Øª', 'Øµ': 'Ù…ØµØ±ÙˆÙ Ø´Ø®ØµÙŠ', 'Ø±': 'Ø±ØµÙŠØ¯'};

    window.onload = function() {
        document.getElementById('lock-screen').style.display = 'flex';
        document.getElementById('main-app').style.display = 'none';
        document.getElementById('passInput').focus();
    };

    function unlock(v) {
        if(v === "2006") {
            document.getElementById('lock-screen').style.display = 'none';
            document.getElementById('main-app').style.display = 'block';
            updateUI();
        }
    }

    function addItem() {
        let name = document.getElementById('inName').value;
        let price = parseFloat(document.getElementById('inPrice').value);
        let note = document.getElementById('inNote').value || "-";
        if(!name || isNaN(price)) return;
        if(shortcuts[name]) name = shortcuts[name];

        db.push({ id: Date.now(), name, price: price * 1000, note, date: new Date().toLocaleDateString('ar-EG') });
        localStorage.setItem(USER_ID, JSON.stringify(db));
        updateUI();
        document.getElementById('inName').value = ''; document.getElementById('inPrice').value = '';
    }

    function updateUI() {
        let spent = 0;
        const body = document.getElementById('mainTable');
        body.innerHTML = '';
        db.forEach(i => spent += i.price);
        document.getElementById('totalSpent').innerText = spent.toLocaleString();
        document.getElementById('totalBalance').innerText = (SALARY - spent).toLocaleString();

        db.slice().reverse().forEach(item => {
            const row = body.insertRow();
            row.innerHTML = `
                <td style="font-size:0.8rem">${item.date}</td>
                <td style="font-weight:bold">${item.name}</td>
                <td style="font-weight:bold; color:var(--gold)">${item.price.toLocaleString()}</td>
                <td style="font-size:0.85rem; color:#8b949e">${item.note}</td>
                <td><i class="fas fa-trash" style="color:#ff7b72; cursor:pointer" onclick="deleteItem(${item.id})"></i></td>`;
        });
    }

    function deleteItem(id) {
        if(confirm("Ø­Ø°ÙØŸ")) { db = db.filter(i => i.id !== id); localStorage.setItem(USER_ID, JSON.stringify(db)); updateUI(); }
    }

    function openLog() {
        document.getElementById('log-modal').style.display = 'block';
        const cats = {};
        db.forEach(i => cats[i.name] = (cats[i.name] || 0) + i.price);
        let html = '';
        for(let c in cats) html += `<div style="display:flex; justify-content:space-between; padding:10px; border-bottom:1px solid #333;"><span>${c}</span><b>${cats[c].toLocaleString()}</b></div>`;
        document.getElementById('logBody').innerHTML = html || "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª";
    }

    async function printSummary() {
        const cats = {}; let total = 0;
        db.forEach(i => { cats[i.name] = (cats[i.name] || 0) + i.price; total += i.price; });

        const now = new Date();
        document.getElementById('rec-date-top').innerText = now.toLocaleDateString('ar-EG') + " | " + now.toLocaleTimeString('ar-EG');
        let itemsHtml = '';
        for(let c in cats) itemsHtml += `<div class="rec-row"><span>${c}</span><span>${cats[c].toLocaleString()}</span></div>`;
        
        document.getElementById('receipt-items-list').innerHTML = itemsHtml;
        document.getElementById('rec-grand-total').innerText = total.toLocaleString();

        html2canvas(document.getElementById('summary-receipt'), { backgroundColor: "#fffbe6", scale: 3 }).then(canvas => {
            const link = document.createElement('a');
            link.download = `Report_${Date.now()}.png`;
            link.href = canvas.toDataURL();
            link.click();
        });
    }

    function closeLog() { document.getElementById('log-modal').style.display = 'none'; }
</script>
</body>
</html>
